<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Understanding Errors of Cardinality Estimators | Charlie Dickens</title> <meta name="author" content="Charlie Dickens"/> <meta name="description" content="Converting from relative error to RSE bounds"/> <meta name="keywords" content="j#ekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="/assets/img/mountain-svgrepo-com.svg"/> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://c-dickens.github.io/blog/2023/cardinality-errors/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <d-front-matter> <script async type="text/json">{
      "title": "Understanding Errors of Cardinality Estimators",
      "description": "Converting from relative error to RSE bounds",
      "published": "September 22, 2023",
      "authors": [
        {
          "author": "Charlie Dickens",
          "authorURL": "",
          "affiliations": [
            {
              "name": "",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <body class="fixed-top-nav"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://c-dickens.github.io/">Charlie Dickens</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Posts<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/publications/">Publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/projects/">projects</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="post distill"> <d-title> <h1>Understanding Errors of Cardinality Estimators</h1> <p>Converting from relative error to RSE bounds</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#error-guarantees-for-cardinality-estimators">Error Guarantees for Cardinality Estimators</a></div> <div><a href="#from-relative-errors-to-error-distributions">From Relative Errors to Error Distributions</a></div> </nav> </d-contents> <h1 id="error-guarantees-for-cardinality-estimators">Error Guarantees for Cardinality Estimators</h1> <p><em>A note to on how to derive the error rates for common cardinality estimation algorithms when the number of buckets is large enough to assume Gaussian error</em>.</p> <p>Probabilistic approximation algorithms often come with what is called \((\epsilon, \delta)\) guarantees.<br> Such a guarantee means that with probability at least \(1-\delta\), the algorithm returns an estimate that is accurate within some bounds that are defined by the parameter \(\epsilon\). The specific type of guarantee may vary from algorithm to algorithm; for example, if the quantity we wish to estimate is \(x\) and the returned value is \(\hat{x}\), then we may seek estimates of the form \((1-\epsilon) x \le \hat{x} \le (1+\epsilon)x.\) Alternatively, other types of algorithm (e.g. a CountMin sketch) returns estimates of the form: \(x \le \hat{x} \le (1+\epsilon)x.\)</p> <p>However, <em>cardinality estimation</em> algorithms typically come with a guarantee on the <em>standard error</em> or the <em>variance</em> of the estimator. These guarantees are related and it often takes me an annoying amount of time to translate between the two. This is especially frustrating because when I think of common unique counting algorithms (such as the \(k\)-minimum values) algorithm, there is an associated guarantee of correctness for that algorithm. However, that guarantee is not strictly the same as the one that is given in common libraries such as <a href="https://datasketches.apache.org/docs/Theta/ThetaErrorTable.html" target="_blank" rel="noopener noreferrer">Apache DataSketches error tables</a>. So how to map between the two? The answer is failry simple when the number of buckets in the sketch is large (nb. if this is not the case then the error distribution gets <a href="https://datasketches.apache.org/docs/HLL/HLL.html" target="_blank" rel="noopener noreferrer">truncated at zero and is not Gaussian</a>).</p> <h2 id="from-relative-errors-to-error-distributions">From Relative Errors to Error Distributions</h2> <p>For an input dataset, the cardinality is the number of distinct items in the dataset without multiplicities. Suppose that a cardinality estimation algorithm returns an estimate \(\hat{n}\) for a (multi)set of cardinality \(n\) with standard error \(\sqrt{c} n / \sqrt{k}\). The constant \(c\) is algorithm dependent and the parameter \(k\) is the number of retained samples (or buckets in the sketch). This means that the variance (another way of writing the guarantees) of the estimator is \(c n^2 / k\) and the relative standard error is \(\sqrt{c} / \sqrt{k}\). The <strong>relative standard error</strong> corresponds to the <strong>relative error</strong> that we typically see in algorithms papers; hence we can set \(\epsilon = \sqrt{c} / \sqrt{k}\) so that the number of samples or buckets is related to error as \(k = c / \epsilon^2.\) This format is much closer to what youâ€™ll see in an algorithms paper rather than a statistical paper. It is also easy to get a simple bound on the total space usage of the algorithm by multiplying through the size of the hash domain that is used in the algorithm to get \(\textsf{space} = c \log(U) \epsilon^{-2}.\)</p> <p>Now, how do we use this? Practitioners often want to know how to set the size of the cardinality estimator so that they have confidence interval for the parameter being estimated. To do so, set the failure probability of the algorithm to be \(\delta = 0.05\) which means that we will roughly obtain a \(95\%\) confidence interval. When the number of samples is large enough, the error distribution is (approximately) Gaussian so the associated \(z\)-score is \(1.96\) which we use to adjust the number of buckets as \(k = \frac{c \cdot 1.96^2}{\epsilon^2}.\) If you want different confidence intervals, then you adjust the rescaling factor from the \(z\)-score accordingly.</p> <p>This expression will give the commonly used error bounds for standard sketches. Improved bounds can be given with more work, but once you begin to merge sketches, things tend to revert to the setting given above. All of this is done assuming that the number of buckets in the sketch is sufficiently large to assume Gaussian errors. If the number of buckets is small, then the distribution gets truncated at zero and this squashes the distribution so the analysis above does not apply.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> </div> <footer class="fixed-bottom"> <div class="container mt-0"> Â© Copyright 2025 Charlie Dickens. </div> </footer> <d-bibliography src="/assets/bibliography/2023-09-23-cardinality.bib"></d-bibliography> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> </body> </html>